<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì¶”ì²œ ê²°ê³¼ ì‹œê°í™”</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* ì „ì²´ í˜ì´ì§€ì— ì¤‘ì•™ ì •ë ¬ */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        h1 {
            margin-top: 20px;
        }

        /* Flexboxë¡œ ë‘ ê·¸ë˜í”„ì™€ í…ìŠ¤íŠ¸ë¥¼ ìƒë‹¨ì— ë‚˜ë€íˆ ë°°ì¹˜ */
        .chart-container-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
            max-width: 1400px;
            margin-top: 30px;
            padding: 0 20px;
        }

        /* ì°¨íŠ¸ì˜ í¬ê¸° ì„¤ì • */
        .chart {
            width: 48%;
            height: 350px;
        }

        /* í…ìŠ¤íŠ¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .text-box {
            width: 48%;
            padding: 10px;
            background-color: #f7f7f7;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 0;
            margin-left: 10px; /* ê°„ê²© ì¤„ì´ê¸° */
            max-height: 350px;
            overflow-y: auto;
        }

        .text-box h3 {
            margin-bottom: 8px;  /* í…ìŠ¤íŠ¸ ê°„ê²© ì¢íˆê¸° */
            font-size: 15px;  /* í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
        }

        .text-box p {
            font-size: 13px;  /* í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
            line-height: 1.5;
        }

        /* Word2Vec 3D ì‹œê°í™” í¬ê¸° ì¡°ì • */
        #word2vec-graph {
            width: 1000px;
            height: 600px;
            margin-top: 50px;
            margin-left: auto;
            margin-right: auto;  /* ì¤‘ì•™ ì •ë ¬ */
        }

        /* ê²€ìƒ‰ ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .search-box {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .search-input {
            padding: 10px;
            font-size: 16px;
            width: 300px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .search-button {
            padding: 10px;
            font-size: 16px;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>ì¶”ì²œ ê²°ê³¼ ì‹œê°í™”</h1>

    <!-- ê²€ìƒ‰ ê¸°ëŠ¥ -->
    <div class="search-box">
        <input id="selected_ingredient" type="text" class="search-input" placeholder="ê²€ìƒ‰í•  ì„±ë¶„ëª… ì…ë ¥">
        <button class="search-button" onclick="updateVisualization()">ê²€ìƒ‰</button>
    </div>

    <!-- ìƒë‹¨ì— ê²€ìƒ‰ ì„±ëŠ¥ ì§€í‘œì™€ ì¶”ì²œ ë‹¤ì–‘ì„± ë°°ì¹˜ -->
    <div class="chart-container-top">
        <!-- ê²€ìƒ‰ ì„±ëŠ¥ ì§€í‘œ ì°¨íŠ¸ -->
        <div id="metricsChart" class="chart"></div>
        
        <!-- í…ìŠ¤íŠ¸ ë°•ìŠ¤ -->
        <div class="text-box">
            <h3>â–  ê²€ìƒ‰ ì •í™•ë„</h3>
            <p>ê²€ìƒ‰ ì •í™•ë„ëŠ” ì…ë ¥ëœ ì„±ë¶„(ì˜ˆ: ì œë¼ë‹ˆì˜¬, íœí‹¸ë Œê¸€ë¼ì´ì½œ, ë±ìŠ¤íŠ¸ë¦°)ì´ í¬í•¨ëœ ì œí’ˆì´ ì‹¤ì œ ê²€ìƒ‰ ê²°ê³¼ì— ì–¼ë§ˆë‚˜ ì •í™•í•˜ê²Œ ë°˜ì˜ë˜ëŠ”ì§€ë¥¼ ì¸¡ì •í•˜ëŠ” ì§€í‘œì…ë‹ˆë‹¤.</p>
            <p>ê²€ìƒ‰ëœ ì œí’ˆì˜ ì„±ë¶„ ë¦¬ìŠ¤íŠ¸ì— ì…ë ¥í•œ ì„±ë¶„ì´ í¬í•¨ë˜ì–´ ìˆì„ìˆ˜ë¡ ê²€ìƒ‰ ì •í™•ë„ê°€ ë†’ì•„ì§€ë©°, ì •í™•ë„ë¥¼ 0~1 ì‚¬ì´ì˜ ê°’ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë©°, 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ê²€ìƒ‰ëœ ì œí’ˆë“¤ì´ ì…ë ¥ ì„±ë¶„ê³¼ ë†’ì€ ê´€ë ¨ì„±ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</p>

            <h3>â–  ì¶”ì²œ ë‹¤ì–‘ì„±</h3>
            <p>ì¶”ì²œ ë‹¤ì–‘ì„±(ìœ ì‚¬ë„ í‘œì¤€í¸ì°¨)ì€ ì¶”ì²œëœ ì œí’ˆë“¤ì˜ ìœ ì‚¬ë„ ë¶„í¬ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œì…ë‹ˆë‹¤. ìœ ì‚¬ë„ ì ìˆ˜ì˜ í‘œì¤€í¸ì°¨(ë³€ë™ì„±)ë¥¼ ì¸¡ì •í•˜ë©°, ê°’ì´ í¬ë©´ ì¶”ì²œëœ ì œí’ˆë“¤ì˜ ìœ ì‚¬ë„ê°€ ë„“ê²Œ ë¶„í¬ë˜ì–´ ìˆìŒì„ ì˜ë¯¸í•˜ë©°, ë‹¤ì–‘ì„±ì´ ë†’ì„ìˆ˜ë¡ ë¹„ìŠ·í•œ ì œí’ˆë“¤ë§Œ ì¶”ì²œë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ì œí’ˆì´ í¬í•¨ë©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- í‰ê·  ìœ ì‚¬ë„ ì›í˜• ê·¸ë˜í”„ì™€ í…ìŠ¤íŠ¸ ë°•ìŠ¤ ë°°ì¹˜ -->
    <div class="chart-container-top">
        <!-- í‰ê·  ìœ ì‚¬ë„ ì›í˜• ê·¸ë˜í”„ -->
        <div id="similarityChart" class="chart"></div>

        <!-- í…ìŠ¤íŠ¸ ë°•ìŠ¤ -->
        <div class="text-box">
            <h3>â–  í‰ê·  ìœ ì‚¬ë„</h3>
            <p>í‰ê·  ìœ ì‚¬ë„ê°€ ë†’ë‹¤ëŠ” ê²ƒì€ ê²€ìƒ‰ëœ ì œí’ˆë“¤ì´ ì…ë ¥ëœ ì„±ë¶„ê³¼ ë”ìš± ìœ ì‚¬í•œ ì œí’ˆì´ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.</p>
        </div>
    </div>

    <!-- Word2Vec 3D ì‹œê°í™” -->
    <div id="word2vec-graph"></div>

    <script>
        function drawWord2VecGraph(word2vec_x, word2vec_y, word2vec_z, ingredient_names, hover_names, selected_ingredient) {
            let sizes = Array(word2vec_x.length).fill(8);  // ê¸°ë³¸ í¬ê¸°
            let colors = word2vec_z.map(z => z);  // ìƒ‰ìƒ ë§¤í•‘

            // âœ… ì¤‘ì‹¬ ì„±ë¶„ ê°•ì¡° (í¬ê¸° ë° ìƒ‰ìƒ ë³€ê²½)
            if (selected_ingredient) {
                sizes[0] = 15;  // âœ… ì¤‘ì‹¬ ì„±ë¶„ í¬ê¸° í™•ëŒ€
                colors[0] = "red";  // âœ… ì¤‘ì‹¬ ì„±ë¶„ì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ê°•ì¡°
            }

            let trace = {
                x: word2vec_x,
                y: word2vec_y,
                z: word2vec_z,
                mode: 'markers+text',
                type: 'scatter3d',
                text: ingredient_names,
                textposition: 'top center',
                textfont: {
                    size: 10,
                    color: 'black'
                },
                hovertext: hover_names,
                marker: {
                    size: sizes,
                    color: colors,
                    colorscale: 'Viridis',
                    opacity: 0.9
                }
            };

            let layout = {
                title: {
                    text: `Word2Vec 3D ì„±ë¶„ ë¶„í¬ (${selected_ingredient ? selected_ingredient : 'ì „ì²´'})`,
                    font: {
                        size: 20,  // ì œëª© í¬ê¸° ì¡°ì •
                        color: 'black',  // ì œëª© ê¸€ì”¨ ìƒ‰ìƒ ì§„í•˜ê²Œ ì„¤ì •
                        weight: 'bold'  // ê¸€ì”¨ ë‘ê»ê²Œ
                    }
                },
                margin: { l: 0, r: 0, b: 0, t: 50 },
                scene: {
                    xaxis: { title: 'X' },
                    yaxis: { title: 'Y' },
                    zaxis: { title: 'Z' }
                }
            };

            Plotly.newPlot('word2vec-graph', [trace], layout);
        }

        function fetchVisualizationData(selectedIngredient = "") {
            $.ajax({
                url: "/visualization/data",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ "selected_ingredient": selectedIngredient }),
                success: function(data) {
                    console.log("ğŸ” [DEBUG] ê°€ì ¸ì˜¨ ë°ì´í„°:", data);

                    if (data.error) {
                        alert(data.error);
                        return;
                    }

                    var metricsData = [{
                        x: ['ê²€ìƒ‰ ì •í™•ë„', 'ì¶”ì²œ ë‹¤ì–‘ì„±'],
                        y: [data.search_accuracy, data.recommendation_diversity],
                        type: 'bar',
                        marker: { color: '#A0D468' } // ë§‰ëŒ€ ê·¸ë˜í”„ ìƒ‰ìƒ ë³€ê²½ (ì´ë¯¸ì§€ ì† ì´ˆë¡ìƒ‰)
                    }];
                    var metricsLayout = { 
                        title: {
                            text: 'ê²€ìƒ‰ ì„±ëŠ¥ ì§€í‘œ',
                            font: {
                                size: 20,
                                color: 'black',
                                weight: 'bold',
                                marker: { color: '#A0D468' } // ë§‰ëŒ€ ê·¸ë˜í”„ ìƒ‰ìƒ ë³€ê²½ (ì´ë¯¸ì§€ ì† ì´ˆë¡ìƒ‰)
                            }
                        }
                    };
                    Plotly.newPlot('metricsChart', metricsData, metricsLayout);

                    // âœ… 3D ê·¸ë˜í”„ í‘œì‹œ (ì¤‘ì‹¬ ì„±ë¶„ ê°•ì¡°)
                    drawWord2VecGraph(data.word2vec_x, data.word2vec_y, data.word2vec_z, data.word2vec_labels, data.hover_labels, data.selected_ingredient);

                    // í‰ê·  ìœ ì‚¬ë„ ì›í˜• ê·¸ë˜í”„
                    var similarityData = [{
                        values: [data.average_similarity, 100 - data.average_similarity],
                        labels: ['ìœ ì‚¬ë„', 'ê¸°íƒ€'],
                        type: 'pie',
                        hole: 0.3,
                        marker: { colors: ['#A0D468', '#d3d3d3'] } // íŒŒì´ ê·¸ë˜í”„ ìƒ‰ìƒ ë³€ê²½ (ì´ë¯¸ì§€ ì† ì´ˆë¡ìƒ‰, íšŒìƒ‰)

                    }];
                    var similarityLayout = {
                        title: {
                            text: 'í‰ê·  ìœ ì‚¬ë„',
                            font: {
                                size: 20,
                                color: 'black',
                                weight: 'bold'
                            }
                        },
                        showlegend: false
                    };

                    // í‰ê·  ìœ ì‚¬ë„ ì›í˜• ê·¸ë˜í”„ í‘œì‹œ
                    Plotly.newPlot('similarityChart', similarityData, similarityLayout);
                },
                error: function(xhr) {
                    console.error("âŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ", xhr.responseText);
                    alert("ì˜¤ë¥˜ ë°œìƒ: " + xhr.responseText);
                }
            });
        }

        function updateVisualization() {
            let selectedIngredient = $("#selected_ingredient").val().trim();
            fetchVisualizationData(selectedIngredient);
        }

        $(document).ready(function() {
            fetchVisualizationData();
        });
    </script>
</body>
</html>
